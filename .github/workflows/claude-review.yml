name: Claude Code Review

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  claude-review:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v42
      with:
        files: |
          **/*.ts
          **/*.tsx
          **/*.js
          **/*.jsx
          **/*.py
          **/*.java
          **/*.go
          **/*.rs
          **/*.cpp
          **/*.c
          **/*.h

    - name: Claude Code Review
      if: steps.changed-files.outputs.any_changed == 'true'
      uses: anthropics/claude-action@v1
      with:
        anthropic-api-key: ${{ secrets.ANTHROPIC_API_KEY }}
        files: ${{ steps.changed-files.outputs.all_changed_files }}
        prompt: |
          Please review the following code changes for:
          1. Code quality and best practices
          2. Potential bugs or security issues
          3. Performance considerations
          4. Maintainability and readability
          5. Adherence to project conventions
          
          Provide constructive feedback and suggestions for improvement.
          Focus on the most important issues and be concise.
        
        github-token: ${{ secrets.GITHUB_TOKEN }}
        create-comment: true
        max-tokens: 2000